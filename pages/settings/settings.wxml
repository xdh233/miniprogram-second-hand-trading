<view class="container">
  <!-- 个人信息设置 -->
  <view class="section">
    <view class="section-title">个人信息</view>
    <view class="section-content">
      <!-- 修改头像 -->
      <view class="setting-item" bindtap="changeAvatar">
        <view class="item-left">
          <image class="item-icon" src="../../images/profile.png" mode="aspectFit" />
          <text class="item-text">头像</text>
        </view>
        <view class="item-right">
          <!-- 使用 apiConfig 处理头像URL -->
          <image class="current-avatar" src="{{avatarUrl}}" mode="aspectFill" />
          <image class="arrow-icon" src="../../images/arrow-right.png" mode="aspectFit" />
        </view>
      </view>

      <!-- 修改昵称 -->
      <view class="setting-item" bindtap="showNicknameEdit">
        <view class="item-left">
          <image class="item-icon" src="../../images/edit.png" mode="aspectFit" />
          <text class="item-text">昵称</text>
        </view>
        <view class="item-right">
          <text class="current-value">{{userInfo.nickname || userInfo.name}}</text>
          <image class="arrow-icon" src="../../images/arrow-right.png" mode="aspectFit" />
        </view>
      </view>

      <!-- 修改简介 -->
      <view class="setting-item" bindtap="showBioEdit">
        <view class="item-left">
          <image class="item-icon" src="../../images/info.png" mode="aspectFit" />
          <text class="item-text">个人简介</text>
        </view>
        <view class="item-right">
          <text class="current-value">{{userInfo.bio || '未设置'}}</text>
          <image class="arrow-icon" src="../../images/arrow-right.png" mode="aspectFit" />
        </view>
      </view>

      <!-- 修改性别 -->
      <view class="setting-item" bindtap="showGenderSelect">
        <view class="item-left">
          <image class="item-icon" src="../../images/gender.png" mode="aspectFit" />
          <text class="item-text">性别</text>
        </view>
        <view class="item-right">
          <text class="current-value">{{userInfo.gender || '未设置'}}</text>
          <image class="arrow-icon" src="../../images/arrow-right.png" mode="aspectFit" />
        </view>
      </view>
    </view>
  </view>

  <!-- 通知设置 -->
  <view class="section">
    <view class="section-title">
      通知设置
      <view class="loading-indicator" wx:if="{{isSettingsLoading}}">加载中...</view>
    </view>
    <view class="section-content">
      <!-- 评论通知 -->
      <view class="setting-item">
        <view class="item-left">
          <image class="item-icon" src="../../images/comment.png" mode="aspectFit" />
          <text class="item-text">评论通知</text>
        </view>
        <view class="item-right">
          <switch checked="{{settings.commentNotify}}" bindchange="toggleCommentNotify" disabled="{{isSettingsLoading}}" />
        </view>
      </view>

      <!-- 点赞通知 -->
      <view class="setting-item">
        <view class="item-left">
          <image class="item-icon" src="../../images/like.png" mode="aspectFit" />
          <text class="item-text">点赞通知</text>
        </view>
        <view class="item-right">
          <switch checked="{{settings.likeNotify}}" bindchange="toggleLikeNotify" disabled="{{isSettingsLoading}}" />
        </view>
      </view>

    </view>
  </view>

  <!-- 账号管理 -->
  <view class="section">
    <view class="section-title">账号管理</view>
    <view class="section-content">
      <!-- 退出登录 -->
      <view class="setting-item logout-item" bindtap="logout">
        <view class="item-left">
          <image class="item-icon logout-icon" src="../../images/logout.png" mode="aspectFit" />
          <text class="item-text logout-text">退出登录</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 昵称修改弹窗 -->
  <view class="modal-mask" wx:if="{{showNicknameModal}}" bindtap="cancelNickname">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-title">修改昵称</view>
      <input 
        class="modal-input {{nicknameError ? 'input-error' : ''}}" 
        value="{{tempNickname}}" 
        placeholder="请输入昵称"
        maxlength="20"
        bindinput="onNicknameInput"
        focus="{{showNicknameModal}}"
      />
      <view class="error-text" wx:if="{{nicknameError}}">{{nicknameError}}</view>
      <view class="modal-buttons">
        <view class="modal-button cancel" bindtap="cancelNickname">取消</view>
        <view class="modal-button confirm {{nicknameError || isLoading ? 'disabled' : ''}}" bindtap="confirmNickname">
          {{isLoading ? '保存中...' : '确定'}}
        </view>
      </view>
    </view>
  </view>

  <!-- 简介修改弹窗 -->
  <view class="modal-mask" wx:if="{{showBioModal}}" bindtap="cancelBio">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-title">修改个人简介</view>
      <textarea 
        class="modal-textarea" 
        value="{{tempBio}}" 
        placeholder="请输入个人简介"
        maxlength="50"
        bindinput="onBioInput"
        focus="{{showBioModal}}"
      ></textarea>
      <view class="char-count">{{tempBio.length || 0}}/50</view>
      <view class="modal-buttons">
        <view class="modal-button cancel" bindtap="cancelBio">取消</view>
        <view class="modal-button confirm {{isLoading ? 'disabled' : ''}}" bindtap="confirmBio">
          {{isLoading ? '保存中...' : '确定'}}
        </view>
      </view>
    </view>
  </view>

  <!-- 性别选择弹窗 -->
  <view class="modal-mask" wx:if="{{showGenderModal}}" bindtap="cancelGender">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-title">选择性别</view>
      <view class="gender-options">
        <view 
          class="gender-option {{tempGender === '女' ? 'selected' : ''}}"
          data-gender="女"
          bindtap="selectGender"
        >
          <text>女</text>
        </view>
        <view 
          class="gender-option {{tempGender === '男' ? 'selected' : ''}}"
          data-gender="男"
          bindtap="selectGender"
        >
          <text>男</text>
        </view>
        <view 
          class="gender-option {{tempGender === '未设置' ? 'selected' : ''}}"
          data-gender="未设置"
          bindtap="selectGender"
        >
          <text>未设置</text>
        </view>
      </view>
      <view class="modal-buttons">
        <view class="modal-button cancel" bindtap="cancelGender">取消</view>
        <view class="modal-button confirm {{isLoading ? 'disabled' : ''}}" bindtap="confirmGender">
          {{isLoading ? '保存中...' : '确定'}}
        </view>
      </view>
    </view>
  </view>
</view>