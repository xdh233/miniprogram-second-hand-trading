<view class="profile-container">
  <view wx:if="{{loading}}" class="loading-wrapper">
    <view class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>

  <view wx:elif="{{error}}" class="error-wrapper">
    <view class="error">
      <text>{{error}}</text>
      <button class="retry-btn" bindtap="loadUserProfile">é‡è¯•</button>
    </view>
  </view>

  <view wx:else class="profile-content">
    <view class="user-header">
      <view class="user-info">
        <view class="avatar-wrapper" bindtap="onAvatarTap">
          <image class="avatar" src="{{userInfo.avatar || 'https://picsum.photos/120/120?random=avatar'}}" />
        </view>
        
        <view class="user-details">
          <view class="user-name">
            <text class="nickname">{{userInfo.nickname || userInfo.name}}</text>
            <view class="gender female">â™€</view>
          </view>
          <text wx:if="{{userInfo.bio}}" class="user-bio">{{userInfo.bio}}</text>
          <text wx:else class="user-bio">è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹~</text>
        </view>
      </view>

      <view class="action-buttons">
        <button wx:if="{{isCurrentUser}}" class="edit-btn" bindtap="editProfile">
          ç¼–è¾‘èµ„æ–™
        </button>
        <button wx:else class="message-btn" bindtap="sendMessage">
          ç§ä¿¡
        </button>
      </view>
    </view>

    <view class="content-tabs">
      <view 
        class="tab-item {{activeTab === 'posts' ? 'active' : ''}}" 
        data-tab="posts" 
        bindtap="switchTab"
      >
        åŠ¨æ€
      </view>
      <view 
        class="tab-item {{activeTab === 'sell' ? 'active' : ''}}" 
        data-tab="sell" 
        bindtap="switchTab"
      >
        åœ¨å”®
      </view>
      <view 
        class="tab-item {{activeTab === 'buy' ? 'active' : ''}}" 
        data-tab="buy" 
        bindtap="switchTab"
      >
        æƒ³è¦
      </view>
    </view>

    <view wx:if="{{activeTab === 'posts'}}" class="posts-list">
      <view wx:if="{{userPosts.length === 0}}" class="empty-state">
        <text>è¿˜æ²¡æœ‰å‘å¸ƒåŠ¨æ€</text>
      </view>
      <view wx:else>
        <view 
          wx:for="{{userPosts}}" 
          wx:key="id" 
          class="post-item"
          data-post-id="{{item.id}}"
          bindtap="onPostTap"
        >
          <view class="post-header">
            <text class="post-title">{{item.title}}</text>
            <!-- ä¿®æ”¹è¿™é‡Œï¼šä½¿ç”¨æ ¼å¼åŒ–åçš„æ—¶é—´ -->
            <text class="post-time">{{item.formattedTime}}</text>
          </view>
          <view wx:if="{{item.content}}" class="post-content">
            {{item.content}}
          </view>
          <view wx:if="{{item.images && item.images.length > 0}}" class="post-images">
            <image 
              wx:for="{{item.images}}" 
              wx:for-item="img" 
              wx:key="*this"
              class="post-image" 
              src="{{img}}" 
              mode="aspectFill"
            />
          </view>
          <view class="post-actions">
            <text class="action-item">
              <text class="icon">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
              {{item.likeCount}}
            </text>
            <text class="action-item">
              <text class="icon">ğŸ’¬</text>
              {{item.commentCount}}
            </text>
          </view>
        </view>
      </view>
    </view>
    
    <view wx:if="{{activeTab === 'sell'}}">
      <view wx:if="{{sellItems.length > 0}}" class="items-grid">
        <view class="column left-column">
          <view 
            class="item-card" 
            wx:for="{{leftSellItems}}" 
            wx:key="id" 
            bindtap="navigateToItemDetail" 
            data-id="{{item.id}}"
          >
            <view class="item-image-container">
              <image class="item-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
              <view class="status-tag" wx:if="{{item.status !== 'selling'}}">
                <text wx:if="{{item.status === 'sold'}}">å·²å”®å‡º</text>
                <text wx:if="{{item.status === 'withdrawn'}}">å·²ä¸‹æ¶</text>
              </view>
            </view>
            <view class="item-info">
              <view class="item-title">{{item.title}}</view>
              <view class="item-price">Â¥{{item.price}}</view>
            </view>
          </view>
        </view>

        <view class="column right-column">
          <view 
            class="item-card" 
            wx:for="{{rightSellItems}}" 
            wx:key="id" 
            bindtap="navigateToItemDetail" 
            data-id="{{item.id}}"
          >
            <view class="item-image-container">
              <image class="item-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
              <view class="status-tag" wx:if="{{item.status !== 'selling'}}">
                <text wx:if="{{item.status === 'sold'}}">å·²å”®å‡º</text>
                <text wx:if="{{item.status === 'withdrawn'}}">å·²ä¸‹æ¶</text>
              </view>
            </view>
            <view class="item-info">
              <view class="item-title">{{item.title}}</view>
              <view class="item-price">Â¥{{item.price}}</view>
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-state">
        <view class="empty-text">æš‚æ— åœ¨å”®å•†å“</view>
      </view>
    </view>

    <view wx:if="{{activeTab === 'buy'}}">
      <view wx:if="{{buyItems.length > 0}}" class="items-grid">
        <view class="column left-column">
          <view 
            class="item-card" 
            wx:for="{{leftBuyItems}}" 
            wx:key="id" 
            bindtap="navigateToItemDetail" 
            data-id="{{item.id}}"
          >
            <view class="item-image-container">
              <image class="item-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
              <view class="status-tag" wx:if="{{item.status !== 'seeking'}}">
                <text wx:if="{{item.status === 'bought'}}">å·²ä¹°åˆ°</text>
                <text wx:if="{{item.status === 'withdrawn'}}">å·²å–æ¶ˆ</text>
              </view>
            </view>
            <view class="item-info">
              <view class="item-title">{{item.title}}</view>
              <view class="item-price want-price">Â¥{{item.price}}</view>
            </view>
          </view>
        </view>

        <view class="column right-column">
          <view 
            class="item-card" 
            wx:for="{{rightBuyItems}}" 
            wx:key="id" 
            bindtap="navigateToItemDetail" 
            data-id="{{item.id}}"
          >
            <view class="item-image-container">
              <image class="item-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
              <view class="status-tag" wx:if="{{item.status !== 'seeking'}}">
                <text wx:if="{{item.status === 'bought'}}">å·²ä¹°åˆ°</text>
                <text wx:if="{{item.status === 'withdrawn'}}">å·²å–æ¶ˆ</text>
              </view>
            </view>
            <view class="item-info">
              <view class="item-title">{{item.title}}</view>
              <view class="item-price want-price">Â¥{{item.price}}</view>
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="empty-state">
        <view class="empty-text">æš‚æ— æ±‚è´­ä¿¡æ¯</view>
      </view>
    </view>
  </view>
</view>