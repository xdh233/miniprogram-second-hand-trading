<!--pages/post-detail/post-detail.wxml-->
<view class="page-container">
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å¸–å­è¯¦æƒ… -->
  <view wx:else class="content-scroll" scroll-y="{{true}}" enhanced="{{true}}">
    
    <!-- ä¸»å¸–å†…å®¹å¡ç‰‡ -->
    <view wx:if="{{post}}" class="post-card">
      
      <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
      <view class="user-section">
        <image class="user-avatar" src="{{post.userAvatar}}" mode="aspectFill" />
        <view class="user-info">
          <text class="username">{{post.userNickname}}</text>
          <text class="post-time">{{post.timeAgo}}</text>
        </view>
        <button class="chat-btn" bindtap="onPrivateChat">ç§ä¿¡</button>
      </view>

      <!-- å¸–å­æ­£æ–‡å†…å®¹ -->
      <view class="post-content">
        <text class="content-text">{{post.content}}</text>
      </view>

      <!-- å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
      <view wx:if="{{post.images && post.images.length > 0}}" class="images-section">
        <view class="images-grid">
          <image wx:for="{{post.images}}" 
                 wx:key="*this" 
                 wx:for-item="img"
                 wx:for-index="imgIndex"
                 class="post-image" 
                 src="{{img}}" 
                 mode="aspectFill"
                 data-images="{{post.images}}"
                 data-index="{{imgIndex}}"
                 bindtap="previewImage" />
        </view>
      </view>
      
      <!-- ç‚¹èµå’Œè¯„è®ºæŒ‰é’® -->
      <view class="action-buttons">
        <button class="action-btn share-btn" open-type="share">
          <image class="action-icon" src="/images/forward.png" mode="aspectFit" />
          <text class="action-text">åˆ†äº«</text>
        </button>

        <view class="action-btn comment-btn">
          <image class="action-icon" src="/images/comment.png" mode="aspectFit" />
          <text class="action-count">{{post.comments || 0}}</text>
        </view>
        
        <view class="action-btn like-btn {{post.isLiked ? 'liked' : ''}}" bindtap="onLikePost">
          <image class="action-icon" src="{{post.isLiked ? '/images/like-active.png' : '/images/like.png'}}" mode="aspectFit" />
          <text class="action-count">{{post.likes || 0}}</text>
        </view>
      </view>

    </view>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <view class="comments-container">
      
      <!-- è¯„è®ºæ ‡é¢˜ -->
      <view class="comments-header">
        <text class="comments-title">è¯„è®º</text>
        <text class="comments-count">({{comments.length}})</text>
      </view>
      
      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comments-list">
        <view wx:for="{{comments}}" wx:key="id" class="comment-item">
          <image class="comment-avatar" src="{{item.userAvatar}}" mode="aspectFill" />
          <view class="comment-main">
            <view class="comment-user-info">
              <text class="comment-username">{{item.userNickname}}</text>
              <text wx:if="{{item.isAuthor}}" class="author-tag">æ¥¼ä¸»</text>
              <text class="comment-time">{{item.timeAgo}}</text>
            </view>
            <text class="comment-content">{{item.content}}</text>
          </view>
        </view>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{loadingMore}}" class="loading-more">
          <text>åŠ è½½æ›´å¤šè¯„è®º...</text>
        </view>
        
        <view wx:if="{{!hasMore && comments.length > 0}}" class="no-more-comments">
          <text>å·²æ˜¾ç¤ºå…¨éƒ¨è¯„è®º</text>
        </view>
        
        <view wx:if="{{comments.length === 0 && !loadingMore}}" class="empty-comments">
          <text class="empty-icon">ğŸ’­</text>
          <text class="empty-text">è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§~</text>
        </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨å ä½ï¼Œé¿å…è¢«è¾“å…¥æ¡†é®æŒ¡ -->
    <view class="bottom-placeholder"></view>
  </view>

  <!-- åº•éƒ¨è¯„è®ºè¾“å…¥æ¡† -->
  <view class="comment-input-bar">
    <view class="input-wrapper">
            <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
      <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
      <input class="comment-input"
            placeholder="è¾“å…¥æ¶ˆæ¯..."
            placeholder-class="input-placeholder"
            value="{{commentContent}}"
            bindinput="onCommentInput"
            bindconfirm="submitComment"
            adjust-position="{{false}}"
            bindkeyboardheightchange="onKeyboardHeightChange"
            confirm-type="send"/>
      
      <!-- å‘é€æŒ‰é’® -->
      <view class="send-btn {{commentContent ? 'active' : ''}}" 
            bindtap="submitComment">
        <text>å‘é€</text>
      </view>
    </view>
  </view>
</view>