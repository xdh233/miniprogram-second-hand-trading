<!-- pages/publish-item/publish-item.wxml -->
<view class="publish-container">
  
  <!-- 内容容器 -->
  <view class="content-container">
    
    <!-- 商品图片 -->
    <view class="form-section">
      <view class="section-title">{{tradeType === 'sell' ? '商品图片' : '参考图片'}} <text class="required">*</text></view>
      <view class="image-grid">
        <!-- 已选择的图片 -->
        <view class="image-item" 
              wx:for="{{images}}" 
              wx:key="index"
              data-index="{{index}}"
              bindtap="previewImage">
          <image class="image" src="{{item.url}}" mode="aspectFill"/>
          <view class="delete-btn" 
                data-index="{{index}}" 
                bindtap="deleteImage">
            <text class="delete-icon">×</text>
          </view>
        </view>
        
        <!-- 添加图片按钮 -->
        <view class="add-image-btn" 
              wx:if="{{images.length < maxImages}}"
              bindtap="chooseImages">
          <text class="add-icon">+</text>
          <text class="add-text">添加图片</text>
        </view>
      </view>
      <view class="image-tip">
        <text>{{images.length}}/{{maxImages}} 张图片，第一张为封面图</text>
      </view>
    </view>

    <!-- 商品标题 -->
    <view class="form-section">
      <view class="section-title">{{tradeType === 'sell' ? '商品标题' : '求购标题'}} <text class="required">*</text></view>
      <textarea class="text-input"
                placeholder="{{tradeType === 'sell' ? '简洁描述商品特点，如：九成新 MacBook Pro 13寸' : '简洁描述需求，如：求购 MacBook Pro 13寸'}}"
                placeholder-class="input-placeholder"
                value="{{title}}"
                bindinput="onTitleInput"
                maxlength="50"
                auto-height/>
      <view class="text-count">{{title.length}}/50</view>
    </view>

    <!-- 价格信息 -->
    <view class="form-section">
          <view class="section-title">{{tradeType === 'sell' ? '价格信息' : '预算信息'}} <text class="required">*</text></view>
          <view class="price-row">
            <view class="price-item">
              <text class="price-label">{{tradeType === 'sell' ? '出售价格' : '预算价格'}}</text>
              <view class="price-input-wrapper">
                <text class="currency">¥</text>
                <input class="price-input"
                      placeholder="{{tradeType === 'sell' ? '请输入出售价格' : '请输入预算价格'}}"
                      placeholder-class="input-placeholder"
                      value="{{price}}"
                      bindinput="onPriceInput"
                      type="digit"
                      maxlength="8"/>
              </view>
              <!-- 价格提示 - 使用动态配置 -->
              <view class="price-hints">
                <text class="hint-text">• 价格范围：¥{{priceConfig.min}} - ¥{{priceConfig.max}}</text>
                <text class="hint-text">• 最多支持{{priceConfig.decimalPlaces}}位小数</text>
                <text class="hint-text">• 请输入真实合理的价格</text>
              </view>
            </view>
          </view>
    </view>

    <!-- 商品分类 -->
    <view class="form-section">
      <view class="section-title">{{tradeType === 'sell' ? '商品分类' : '求购分类'}} <text class="required">*</text></view>
      <view class="picker-item" bindtap="showCustomPicker">
        <text class="picker-text {{category ? '' : 'placeholder'}}">
          {{categoryName || '请选择分类'}}
        </text>
        <text class="picker-arrow">›</text>
      </view>
    </view>

    <!-- 自定义选择器弹窗 -->
    <view class="custom-picker-mask {{showPicker ? 'show' : ''}}" bindtap="hidePicker">
      <view class="custom-picker" catchtap="">
        <view class="picker-header">
          <text class="picker-cancel" bindtap="hidePicker">取消</text>
          <text class="picker-title">选择分类</text>
          <text class="picker-confirm" bindtap="confirmPicker">确定</text>
        </view>
        <picker-view style="width: 100%; height: 300rpx;" value="{{[categoryIndex]}}" bindchange="onPickerChange">
          <picker-view-column>
            <view wx:for="{{categories}}" wx:key="value" class="picker-item-custom">
              {{item.name}}
            </view>
          </picker-view-column>
        </picker-view>
      </view>
    </view>

    <!-- 商品描述 -->
    <view class="form-section">
      <view class="section-title">{{tradeType === 'sell' ? '商品描述' : '需求描述'}} <text class="required">*</text></view>
      <textarea class="textarea-input"
                placeholder="{{tradeType === 'sell' ? '详细描述商品状况、购买时间、使用情况等...' : '详细描述需求、期望状况、使用场景等...'}}"
                placeholder-class="input-placeholder"
                value="{{description}}"
                bindinput="onDescriptionInput"
                maxlength="300"
                auto-height/>
      <view class="text-count">{{description.length}}/300</view>
    </view>

    <!-- 发布提示 -->
    <view class="publish-tips">
      <text class="tip-text" wx:if="{{tradeType === 'sell'}}">• 真实描述商品状况，上传清晰图片</text>
      <text class="tip-text" wx:if="{{tradeType === 'buy'}}">• 详细描述需求，便于卖家了解</text>
      <text class="tip-text">• 价格合理，诚信交易</text>
      <text class="tip-text">• 遵守校园二手交易规范</text>
    </view>

  </view>

  <!-- 发布按钮 -->
  <view class="publish-footer">
    <button 
      class="publish-button {{title && price && category && description && images.length > 0 ? 'active' : ''}}"
      bindtap="publishItem"
      disabled="{{publishing}}"
    >
      {{publishing ? (tradeType === 'sell' ? '发布中...' : '求购发布中...') : (tradeType === 'sell' ? '发布闲置' : '发布求购')}}
    </button>
  </view>

</view>