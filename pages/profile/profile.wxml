<!-- profile.wxml - 个人中心页面 -->
<view class="container">
  <!-- 完全模仿消息页面的结构 -->
  <view class="content-container">
    <!-- 个人信息头部 -->
    <view class="user-header">
      <view class="user-info">
        <image class="user-avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}" />
        <view class="user-details">
          <view class="user-name">{{userInfo.name || '未填写昵称'}}</view>
          <view class="user-id">学号: {{userInfo.studentId}}</view>
        </view>
        <view class="settings-btn" bindtap="navigateToSettings">
          <image class="function-icon" src="../../images/settings.png" mode="aspectFill" />
        </view>
      </view>
    </view>

    <!-- 功能列表容器 - 模仿消息页面的 messages-container -->
    <scroll-view 
      class="functions-container"
      scroll-y
      enable-back-to-top
    >
      <!-- 我的钱包 -->
      <view class="section-title">我的钱包</view>
      <view class="function-list">
        <!-- 简单修复：直接显示余额 -->
        <view class="function-item balance-item" bindtap="showBalanceDetail">
          <image class="function-icon" src="../../images/balance.png" mode="aspectFill" />
          <text class="function-text">我的余额</text>
          <!-- 最简单的修复 -->
          <text class="balance-amount">¥{{formattedBalance}}</text>
          <text class="arrow">></text>
        </view>
      </view>

      <!-- 交易相关功能 -->
      <view class="section-title">订单信息</view>
      <view class="function-list">
        <view class="function-item" bindtap="navigateToMyPublished">
          <image class="function-icon" src="../../images/goods_fill.png" mode="aspectFill" />
          <text class="function-text">个人空间</text>
          <text class="arrow">></text>
        </view>

        <view class="function-item" bindtap="navigateToMySold">
          <image class="function-icon" src="../../images/soldout.png" mode="aspectFill" />
          <text class="function-text">我的卖品</text>
          <text class="arrow">></text>
        </view>

        <view class="function-item" bindtap="navigateToMyBought">
          <image class="function-icon" src="../../images/cart_fill.png" mode="aspectFill" />
          <text class="function-text">我的求购</text>
          <text class="arrow">></text>
        </view>

        <!-- <view class="function-item" bindtap="navigateToFavorites">
          <image class="function-icon" src="../../images/favor_fill.png" mode="aspectFill" />
          <text class="function-text">我的收藏</text>
          <text class="arrow">></text>
        </view> -->
      </view>

      <!-- 常用工具 -->
      <view class="section-title">常用工具</view>
      <view class="function-list">
        <!-- 添加意见反馈功能项 -->
        <view class="function-item" bindtap="navigateToFeedback">
          <image class="function-icon" src="../../images/feedback.png" mode="aspectFill" />
          <text class="function-text">意见反馈</text>
          <text class="arrow">></text>
        </view>

        <view class="function-item" bindtap="navigateToAbout">
          <image class="function-icon" src="../../images/creative_fill.png" mode="aspectFill" />
          <text class="function-text">关于开发者</text>
          <text class="arrow">></text>
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- 意见反馈弹窗 -->
<view class="feedback-modal-mask" wx:if="{{showFeedbackModal}}">
  <view class="feedback-modal-container" catchtap="">
    <view class="feedback-modal-title">意见反馈</view>
    
    <view class="feedback-input-container">
      <textarea 
        class="feedback-textarea"
        placeholder="请输入您的意见或建议..."
        placeholder-class="textarea-placeholder"
        value="{{feedbackContent}}"
        bindinput="onFeedbackInput"
        maxlength="{{maxLength}}"
        show-confirm-bar="{{false}}"
        auto-focus="{{true}}"
      ></textarea>
      <view class="char-count">{{feedbackContent.length}}/{{maxLength}}</view>
    </view>
    
    <view class="feedback-modal-footer">
      <button class="feedback-cancel-btn" bindtap="hideFeedbackModal">取消</button>
      <button class="feedback-submit-btn" bindtap="submitFeedback">提交</button>
    </view>
  </view>
</view>

<!-- 充值弹窗 -->
<view class="modal-mask" wx:if="{{showRechargeModal}}" bindtap="cancelRecharge">
  <view class="modal-content recharge-modal" catchtap="stopPropagation">
    <view class="modal-title">账户充值</view>
    
    <!-- 当前余额显示 -->
    <view class="current-balance">
      <text class="balance-label">当前余额</text>
      <text class="balance-value">¥{{formattedBalance}}</text>
    </view>

    <!-- 快速充值金额 -->
    <view class="quick-amounts">
      <view class="quick-amount-title">快速选择</view>
      <view class="amount-buttons">
        <view 
          class="amount-btn {{rechargeAmount === '10' ? 'selected' : ''}}"
          data-amount="10"
          bindtap="selectQuickAmount"
        >
          ¥10
        </view>
        <view 
          class="amount-btn {{rechargeAmount === '50' ? 'selected' : ''}}"
          data-amount="50"
          bindtap="selectQuickAmount"
        >
          ¥50
        </view>
        <view 
          class="amount-btn {{rechargeAmount === '100' ? 'selected' : ''}}"
          data-amount="100"
          bindtap="selectQuickAmount"
        >
          ¥100
        </view>
        <view 
          class="amount-btn {{rechargeAmount === '200' ? 'selected' : ''}}"
          data-amount="200"
          bindtap="selectQuickAmount"
        >
          ¥200
        </view>
      </view>
    </view>

    <!-- 自定义金额输入 -->
    <view class="custom-amount">
      <text class="amount-label">自定义金额</text>
      <view class="amount-input-wrapper">
        <text class="currency-symbol">¥</text>
        <input 
          class="amount-input" 
          value="{{rechargeAmount}}" 
          placeholder="请输入充值金额"
          type="digit"
          bindinput="onRechargeInput"
          focus="{{showRechargeModal}}"
        />
      </view>
    </view>

    <view class="modal-buttons">
      <view class="modal-button cancel" bindtap="cancelRecharge">取消</view>
      <view class="modal-button confirm" bindtap="confirmRecharge">确认充值</view>
    </view>
  </view>
</view>