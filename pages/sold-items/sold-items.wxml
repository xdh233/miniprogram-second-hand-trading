<!-- pages/my-sold-items/my-sold-items.wxml -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-wrapper">
    <view class="loading">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-wrapper">
    <view class="error">
      <text>{{error}}</text>
      <button class="retry-btn" bindtap="loadSoldItems">é‡è¯•</button>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:else>
    <!-- çŠ¶æ€ç­›é€‰æ ‡ç­¾ - å››ä¸ªåˆ†ç±» -->
    <view class="status-tabs">
      <view 
        wx:for="{{statusOptions}}" 
        wx:key="key"
        class="status-tab {{activeStatus === item.key ? 'active' : ''}}"
        data-status="{{item.key}}"
        bindtap="switchStatus"
      >
        <text class="tab-label">{{item.label}}</text>
        <text class="tab-count">({{item.count}})</text>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="items-container">
      <view wx:if="{{filteredItems.length === 0}}" class="empty-state">
        <image class="empty-icon" src="/images/empty-box.png" mode="aspectFit" />
        <text class="empty-text">æš‚æ— ç›¸å…³å•†å“</text>
        <text class="empty-tip">
          {{activeStatus === 'all' ? 'è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å•†å“' : 'è¯¥çŠ¶æ€ä¸‹æš‚æ— å•†å“'}}
        </text>
      </view>

      <view wx:else class="items-list">
        <view 
          wx:for="{{filteredItems}}" 
          wx:key="id"
          class="item-card"
          data-item-id="{{item.id}}"
          bindtap="onItemTap"
        >
          <!-- å•†å“ä¸»è¦å†…å®¹ï¼šå·¦å›¾å³æ–‡å¸ƒå±€ -->
          <view class="item-main-content">
            <!-- å·¦ä¾§ï¼šå•†å“ç¼©ç•¥å›¾ -->
            <view class="item-image-section">
              <image 
                class="item-thumbnail" 
                src="{{item.images && item.images[0] ? item.images[0] : '/images/placeholder.png'}}"
                mode="aspectFill"
              />
              <!-- çŠ¶æ€æ ‡ç­¾ -->
              <view class="status-tag {{item.status === 'åœ¨å”®' ? 'status-selling' : item.status === 'å·²å”®å‡º' ? 'status-sold' : 'status-inactive'}}">
                {{item.status}}
              </view>
            </view>

            <!-- å³ä¾§ï¼šå•†å“ä¿¡æ¯ -->
            <view class="item-detail-section">
              <!-- å•†å“æ ‡é¢˜ -->
              <view class="item-title">{{item.title}}</view>
              
              <!-- å•†å“æè¿° -->
              <view class="item-description">{{item.description}}</view>
              
              <!-- å•†å“ä»·æ ¼ -->
              <view class="item-price-section">
                <text class="price-label">å”®ä»·ï¼š</text>
                <view class="item-price">Â¥{{item.price}}</view>
                <!-- åªæœ‰åœ¨å”®çŠ¶æ€æ‰æ˜¾ç¤ºç¼–è¾‘æŒ‰é’® -->
                <view 
                  wx:if="{{item.status === 'åœ¨å”®'}}" 
                  class="price-edit-btn"
                  data-item-id="{{item.id}}"
                  catchtap="showEditPrice"
                >
                  <image class="edit-icon" src="/images/change2.png" mode="aspectFit" />
                </view>
              </view>              
              <!-- äº¤æ˜“æ—¶é—´å’Œç»Ÿè®¡ä¿¡æ¯ -->
              <view class="item-meta">
                <text class="create-time">å‘å¸ƒï¼š{{item.createTime}}</text>
                <view class="item-stats">
                  <text class="stat-item">ğŸ‘€ {{item.viewCount}}</text>
                  <text class="stat-item">â¤ï¸ {{item.likeCount}}</text>
                </view>
              </view>
            </view>
          </view>

          <!-- ä¹°å®¶ä¿¡æ¯ï¼ˆå·²å”®å‡ºæ—¶æ˜¾ç¤ºï¼‰ -->
          <view wx:if="{{item.buyerId && item.status === 'å·²å”®å‡º'}}" class="buyer-info">
            <view class="buyer-details">
              <image class="buyer-avatar" src="{{item.buyerAvatar}}" />
              <view class="buyer-text">
                <text class="buyer-label">è´­ä¹°è€…ï¼š</text>
                <text class="buyer-name">{{item.buyerName}}</text>
              </view>
            </view>
            <text class="sold-time">å”®å‡ºï¼š{{item.soldTime}}</text>
          </view>

          <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
          <view class="item-actions">
            <!-- åœ¨å”®çŠ¶æ€çš„æŒ‰é’®ï¼šæ ‡è®°å”®å‡ºã€ä¸‹æ¶ã€åˆ é™¤ -->
            <block wx:if="{{item.status === 'åœ¨å”®'}}">
              <button 
                class="action-btn primary"
                data-item-id="{{item.id}}"
                catchtap="markAsSold"
              >
                æ ‡è®°å”®å‡º
              </button>
              <button 
                class="action-btn secondary"
                data-item-id="{{item.id}}"
                catchtap="markAsInactive"
              >
                ä¸‹æ¶
              </button>
              <button 
                class="action-btn danger"
                data-item-id="{{item.id}}"
                catchtap="deleteItem"
              >
                åˆ é™¤
              </button>
            </block>

            <!-- å·²å”®å‡ºçŠ¶æ€ï¼šæ˜¾ç¤ºå®Œæˆä¿¡æ¯å’Œåˆ é™¤æŒ‰é’® -->
            <block wx:if="{{item.status === 'å·²å”®å‡º'}}">
              <view class="sold-info">
                <text class="sold-text">ğŸ‰ äº¤æ˜“å·²å®Œæˆ</text>
              </view>
              <button 
                class="action-btn danger"
                data-item-id="{{item.id}}"
                catchtap="deleteItem"
              >
                åˆ é™¤
              </button>
            </block>

            <!-- å·²ä¸‹æ¶çŠ¶æ€ï¼šé‡æ–°ä¸Šæ¶å’Œåˆ é™¤æŒ‰é’® -->
            <block wx:if="{{item.status === 'å·²ä¸‹æ¶'}}">
              <button 
                class="action-btn primary"
                data-item-id="{{item.id}}"
                catchtap="markAsActive"
              >
                é‡æ–°ä¸Šæ¶
              </button>
              <button 
                class="action-btn danger"
                data-item-id="{{item.id}}"
                catchtap="deleteItem"
              >
                åˆ é™¤
              </button>
            </block>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»·æ ¼ä¿®æ”¹å¼¹çª— - æ”¹è¿›ç‰ˆæœ¬ -->
  <view wx:if="{{showPriceModal}}" class="price-modal-overlay" catchtap="hidePriceModal">
    <view class="price-modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ä¿®æ”¹ä»·æ ¼</text>
      </view>
      
      <view class="modal-content">
        <view class="price-input-section">
          <text class="price-label">æ–°ä»·æ ¼</text>
          <view class="price-input-wrapper">
            <text class="currency-symbol">Â¥</text>
            <input 
              class="price-input"
              type="digit"
              value="{{editingPrice}}"
              placeholder="è¯·è¾“å…¥ä»·æ ¼"
              bindinput="onPriceInput"
              focus="{{showPriceModal}}"
            />
          </view>
        </view>
        
        <view class="price-tip">
          <text class="tip-text">åŸä»·æ ¼ï¼šÂ¥{{originalPrice}}</text>
        </view>
      </view>

      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="cancelPriceEdit">å–æ¶ˆ</view>
        <view class="modal-btn confirm-btn {{!editingPrice || editingPrice <= 0 ? 'disabled' : ''}}" bindtap="confirmPriceEdit">ç¡®å®š</view>
      </view>
    </view>
  </view>
</view>