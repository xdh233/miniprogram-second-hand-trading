<!-- pages/index/index.wxml - 纯帖子流版本 -->
<view class="container">
  <!-- 顶部搜索栏 - 在导航栏下方 -->
  <view class="search-header">
    <view class="search-container">
      <view class="search-box">
        <icon class="search-icon" type="search" size="14" />
        <input 
          class="search-input"
          placeholder="搜索" 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
        />
      </view>
    </view>
  </view>

  <!-- 帖子列表 -->
  <view class="posts-wrapper">
    <scroll-view 
      class="posts-container"
      scroll-y
      enable-back-to-top
      refresher-enabled
      refresher-triggered="{{refreshing}}"
      bindrefresherrefresh="onPullDownRefresh"
      bindscrolltolower="onReachBottom"
    >
    <!-- 帖子卡片 -->
    <view class="post-card" wx:for="{{posts}}" wx:key="id">
      <!-- 用户信息栏 -->
      <view class="post-header">
        <image class="user-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill" />
        <view class="user-info">
          <view class="user-name">{{item.userName}}</view>
          <view class="post-time">{{item.timeAgo}}</view>
        </view>
      </view>

      <!-- 帖子内容 -->
      <view class="post-content">
        <text class="post-text">{{item.content}}</text>
      </view>

      <!-- 图片内容 -->
      <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
        <!-- 单图 -->
        <view class="single-image" wx:if="{{item.images.length === 1}}">
          <image 
            class="post-image" 
            src="{{item.images[0]}}" 
            mode="widthFix"
            bindtap="previewImage"
            data-images="{{item.images}}"
            data-index="0"
          />
        </view>
        
        <!-- 多图网格 -->
        <view class="images-grid {{item.images.length === 2 ? 'grid-2' : item.images.length === 4 ? 'grid-4' : 'grid-3'}}" wx:else>
          <image 
            class="grid-image" 
            wx:for="{{item.images}}" 
            wx:for-item="image"
            wx:for-index="imgIndex"
            wx:key="imgIndex"
            src="{{image}}" 
            mode="aspectFill"
            bindtap="previewImage"
            data-images="{{item.images}}"
            data-index="{{imgIndex}}"
          />
        </view>
      </view>

      <!-- 互动栏 -->
      <view class="post-actions">
        <view class="action-item" bindtap="onSharePost" data-id="{{item.id}}">
          <icon type="success_no_circle" size="18" color="#999" />
          <text class="action-text">转发</text>
        </view>
        
        <view class="action-item" bindtap="onCommentPost" data-id="{{item.id}}">
          <icon type="success_no_circle" size="18" color="#999" />
          <text class="action-text">评论{{item.comments > 0 ? ' ' + item.comments : ''}}</text>
        </view>
        
        <view class="action-item" bindtap="onLikePost" data-id="{{item.id}}" data-index="{{index}}">
          <icon type="{{item.isLiked ? 'success' : 'success_no_circle'}}" size="18" color="{{item.isLiked ? '#ff6b6b' : '#999'}}" />
          <text class="action-text {{item.isLiked ? 'liked' : ''}}">赞{{item.likes > 0 ? ' ' + item.likes : ''}}</text>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="loading-more" wx:if="{{loading && posts.length > 0}}">
      <text>加载中...</text>
    </view>

    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && posts.length > 0}}">
      <text>没有更多内容了</text>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{posts.length === 0 && !loading}}">
      <icon type="info" size="60" color="#ccc" />
      <text class="empty-text">暂无动态</text>
      <text class="empty-desc">快去发布第一条动态吧</text>
    </view>
    </scroll-view>
  </view>

  <!-- 初始加载状态 -->
  <view class="initial-loading" wx:if="{{loading && posts.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>