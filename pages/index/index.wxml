<!-- pages/index/index.wxml - ä¼˜åŒ–ç‰ˆ -->

<!-- è°ƒè¯•åŒºåŸŸ - ç”Ÿäº§ç¯å¢ƒåˆ é™¤ -->
<view class="debug-section" wx:if="{{false}}">
  <view class="debug-info">
    <text>ç™»å½•çŠ¶æ€: {{userInfo ? 'å·²ç™»å½•(' + userInfo.name + ')' : 'æœªç™»å½•'}}</text>
  </view>
  <view class="debug-buttons">
    <button bindtap="debugClearData" size="mini" type="warn">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
  </view>
</view>

<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
  <view class="user-header" wx:if="{{userInfo}}">
    <view class="user-info">
      <image class="user-avatar" src="/images/default-avatar.png" mode="aspectFill" />
      <view class="user-details">
        <view class="greeting">{{timeGreeting}}ï¼Œ{{userInfo.name}}</view>
        <view class="user-desc">ä»Šå¤©æƒ³æ‰¾ç‚¹ä»€ä¹ˆå¥½ä¸œè¥¿ï¼Ÿ</view>
      </view>
    </view>
    <view class="header-actions">
      <view class="message-btn" bindtap="navigateToMessages">
        <icon type="success_circle" size="18" color="#667eea" />
        <view class="message-badge" wx:if="{{unreadCount > 0}}">{{unreadCount > 99 ? '99+' : unreadCount}}</view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-container">
      <view class="search-box">
        <icon class="search-icon" type="search" size="16" />
        <input 
          class="search-input"
          placeholder="æœç´¢ä½ æƒ³è¦çš„å•†å“..." 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          bindfocus="onSearchFocus"
          bindblur="onSearchBlur"
        />
        <view class="search-btn" bindtap="onSearchConfirm">æœç´¢</view>
      </view>
      
      <!-- æœç´¢å»ºè®® -->
      <view class="search-suggestions" wx:if="{{showSearchSuggestions}}">
        <view class="suggestions-header">
          <text>æœç´¢å†å²</text>
          <text class="clear-history" bindtap="clearSearchHistory" wx:if="{{searchHistory.length > 0}}">æ¸…é™¤</text>
        </view>
        <view class="suggestion-tags" wx:if="{{searchHistory.length > 0}}">
          <view class="suggestion-tag" 
                wx:for="{{searchHistory}}" 
                wx:key="index"
                bindtap="onQuickSearch"
                data-keyword="{{item}}">
            {{item}}
          </view>
        </view>
        <view class="no-history" wx:else>æš‚æ— æœç´¢å†å²</view>
      </view>
    </view>
  </view>

  <!-- è½®æ’­å›¾ -->
  <view class="banner-section">
    <swiper 
      class="banner-swiper" 
      indicator-dots="{{true}}" 
      autoplay="{{true}}" 
      interval="4000" 
      duration="300"
      bindchange="onBannerChange">
      <swiper-item wx:for="{{banners}}" wx:key="id">
        <view class="banner-item" bindtap="onBannerTap" data-index="{{index}}">
          <image class="banner-image" src="{{item.image || '/images/placeholder-banner.jpg'}}" mode="aspectFill" />
          <view class="banner-overlay">
            <view class="banner-title">{{item.title}}</view>
            <view class="banner-desc">{{item.desc}}</view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- æ»šåŠ¨å…¬å‘Š -->
  <view class="notice-section">
    <view class="notice-icon">ğŸ“¢</view>
    <swiper class="notice-swiper" vertical="{{true}}" autoplay="{{true}}" interval="3000" duration="500">
      <swiper-item wx:for="{{notices}}" wx:key="index">
        <view class="notice-item">{{item}}</view>
      </swiper-item>
    </swiper>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section">
    <view class="stat-item">
      <view class="stat-number">{{stats.totalItems}}</view>
      <view class="stat-label">å•†å“æ€»æ•°</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{stats.totalUsers}}</view>
      <view class="stat-label">ç”¨æˆ·æ€»æ•°</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{stats.todayItems}}</view>
      <view class="stat-label">ä»Šæ—¥æ–°å¢</view>
    </view>
  </view>

  <!-- å¿«æ·åŠŸèƒ½ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="navigateToPublish">
      <view class="action-icon" style="background: #ff6b6b;">ğŸ“±</view>
      <view class="action-text">å‘å¸ƒå•†å“</view>
    </view>
    <view class="action-item" bindtap="navigateToMyItems">
      <view class="action-icon" style="background: #4ecdc4;">ğŸ“¦</view>
      <view class="action-text">æˆ‘çš„å‘å¸ƒ</view>
    </view>
    <view class="action-item" bindtap="navigateToFavorites">
      <view class="action-icon" style="background: #fd79a8;">â¤ï¸</view>
      <view class="action-text">æˆ‘çš„æ”¶è—</view>
    </view>
    <view class="action-item" bindtap="navigateToProfile">
      <view class="action-icon" style="background: #6c5ce7;">ğŸ‘¤</view>
      <view class="action-text">ä¸ªäººä¸­å¿ƒ</view>
    </view>
  </view>

  <!-- å•†å“åˆ†ç±» -->
  <view class="category-section">
    <view class="section-header">
      <view class="section-title">
        <icon type="success_circle" size="16" color="#667eea" />
        <text>å•†å“åˆ†ç±»</text>
      </view>
    </view>
    
    <view class="category-grid">
      <view class="category-item" 
            wx:for="{{categories}}" 
            wx:key="id" 
            bindtap="navigateToCategory" 
            data-category="{{item}}">
        <view class="category-icon" style="background: {{item.color}};">{{item.icon}}</view>
        <view class="category-name">{{item.name}}</view>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°å‘å¸ƒ -->
  <view class="items-section">
    <view class="section-header">
      <view class="section-title">
        <icon type="success_circle" size="16" color="#4ecdc4" />
        <text>æœ€æ–°å‘å¸ƒ</text>
      </view>
      <view class="section-more" bindtap="navigateToAllItems" data-type="latest">
        æŸ¥çœ‹æ›´å¤š <text class="arrow">></text>
      </view>
    </view>
    
    <scroll-view class="items-scroll" scroll-x wx:if="{{latestItems.length > 0}}">
      <view class="item-card" 
            wx:for="{{latestItems}}" 
            wx:key="id" 
            bindtap="navigateToDetail" 
            data-id="{{item.id}}">
        <image class="item-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
        <view class="item-overlay">
          <view class="item-title">{{item.title}}</view>
          <view class="item-price">Â¥{{item.price}}</view>
        </view>
        <view class="item-tag">{{item.condition}}</view>
      </view>
    </scroll-view>
    
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ“¦</view>
      <view class="empty-text">æš‚æ— æœ€æ–°å•†å“</view>
    </view>
  </view>

  <!-- çƒ­é—¨æ¨è -->
  <view class="items-section">
    <view class="section-header">
      <view class="section-title">
        <icon type="success_circle" size="16" color="#ff6b6b" />
        <text>çƒ­é—¨æ¨è</text>
      </view>
      <view class="section-more" bindtap="navigateToAllItems" data-type="hot">
        æŸ¥çœ‹æ›´å¤š <text class="arrow">></text>
      </view>
    </view>
    
    <view class="hot-grid" wx:if="{{hotItems.length > 0}}">
      <view class="hot-item" 
            wx:for="{{hotItems}}" 
            wx:key="id" 
            bindtap="navigateToDetail" 
            data-id="{{item.id}}">
        <image class="hot-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
        <view class="hot-info">
          <view class="hot-title">{{item.title}}</view>
          <view class="hot-price">Â¥{{item.price}}</view>
          <view class="hot-meta">
            <text class="hot-views">ğŸ‘ {{item.viewCount || 0}}</text>
            <text class="hot-likes">â¤ï¸ {{item.likeCount || 0}}</text>
          </view>
        </view>
        <view class="hot-badge">ğŸ”¥</view>
      </view>
    </view>
    
    <view class="empty-state" wx:else>
      <view class="empty-icon">ğŸ”¥</view>
      <view class="empty-text">æš‚æ— çƒ­é—¨å•†å“</view>
    </view>
  </view>

  <!-- ä¸ºä½ æ¨è -->
  <view class="items-section" wx:if="{{recommendItems.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <icon type="success_circle" size="16" color="#f9ca24" />
        <text>ä¸ºä½ æ¨è</text>
      </view>
    </view>
    
    <view class="recommend-grid">
      <view class="recommend-item" 
            wx:for="{{recommendItems}}" 
            wx:key="id" 
            bindtap="navigateToDetail" 
            data-id="{{item.id}}">
        <image class="recommend-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
        <view class="recommend-info">
          <view class="recommend-title">{{item.title}}</view>
          <view class="recommend-price">Â¥{{item.price}}</view>
          <view class="recommend-seller">@{{item.sellerName}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å ä½ -->
  <view class="bottom-space"></view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>

<!-- åˆ·æ–°æç¤º -->
<view class="refresh-tip" wx:if="{{refreshing}}">
  <view class="refresh-content">
    <icon type="success" size="16" />
    <text>åˆ·æ–°ä¸­...</text>
  </view>
</view>