<!--item-detail.wxml-->
<view class="container">
  <!-- 头部导航 -->
  <view class="header" style="padding-top: {{statusBarHeight + 20}}rpx;">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">‹</text>
    </view>
    <view class="seller-info" bindtap="navigateToSellerProfile">
      <image class="seller-avatar" src="{{item.seller.avatar}}" mode="aspectFill"></image>
      <text class="seller-name">{{item.seller.username}}</text>
    </view>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:else>
    <!-- 商品图片轮播 -->
    <view class="image-container">
      <swiper class="image-swiper" indicator-dots="{{false}}" autoplay="{{false}}" 
              bindchange="onImageChange">
        <swiper-item wx:for="{{item.images}}" wx:key="index">
          <image class="product-image" src="{{item}}" mode="aspectFill" 
                 bindtap="previewImage" data-src="{{item}}"></image>
        </swiper-item>
      </swiper>
      <view class="image-indicator">{{currentImageIndex + 1}}/{{item.images.length}}</view>
    </view>

    <!-- 商品信息 -->
    <view class="product-info">
      <view class="product-price">¥{{item.price}}</view>
      <view class="product-meta">
        <text>发布时间: {{item.formattedPublishTime}}</text>
        <text>浏览：{{item.viewCount}}次</text>
      </view>
    </view>

    <!-- 商品描述 -->
    <view class="product-description">
      <view class="description-title">商品描述</view>
      <view class="description-content">{{item.description}}</view>
    </view>

    <!-- 评论区 -->
    <view class="comments-section">
      <view class="comments-header">共{{comments.length}}条留言</view>
      
      <!-- 评论输入框 -->
      <view class="comment-input">
        <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
        <input class="input-box" type="text" placeholder="说点什么" 
               value="{{newComment}}" bindinput="onCommentInput" 
               bindconfirm="sendComment" confirm-type="send"/>
      </view>

      <!-- 评论列表 -->
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <image class="comment-avatar" src="{{item.avatar}}"></image>
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-username">{{item.username}}</text>
            <!-- 楼主标志 -->
            <text wx:if="{{item.isAuthor}}" class="author-badge">楼主</text>
            <text class="comment-time">{{item.createTime}}</text>
          </view>
          <text class="comment-text">{{item.content}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-actions">
    <view class="action-btn" bindtap="sendComment">
      <view class="action-icon comment-icon">💬</view>
      <text>评论</text>
    </view>
    <view class="action-btn {{isLiked ? 'liked' : ''}}" bindtap="toggleLike">
      <view class="action-icon like-icon">{{isLiked ? '❤️' : '🤍'}}</view>
      <text>{{isLiked ? '收藏' : '收藏'}}</text>
    </view>
    <view class="action-btn" bindtap="onShareClick">
      <view class="action-icon share-icon">📤</view>
      <text>分享</text>
    </view>
    <button class="contact-btn" bindtap="contactSeller">联系卖家</button>
  </view>
</view>