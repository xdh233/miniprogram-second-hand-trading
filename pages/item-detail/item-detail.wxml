<!-- pages/item-detail/item-detail.wxml -->
<view class="container">
  <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
  <view class="image-section">
    <swiper class="image-swiper" indicator-dots="{{item.images.length > 1}}" autoplay="{{false}}" interval="5000" duration="500">
      <swiper-item wx:for="{{item.images}}" wx:key="index">
        <image class="item-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}" />
      </swiper-item>
    </swiper>
    <view class="image-count" wx:if="{{item.images.length > 1}}">
      {{currentImageIndex + 1}}/{{item.images.length}}
    </view>
  </view>

  <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
  <view class="item-info">
    <view class="item-title">{{item.title}}</view>
    <view class="item-price">Â¥{{item.price}}</view>
    <view class="item-tags">
      <view class="tag">{{item.category}}</view>
      <view class="tag condition-tag">{{item.condition}}</view>
      <view class="tag" wx:if="{{item.isNegotiable}}">å¯è®®ä»·</view>
    </view>
    <view class="item-meta">
      <view class="meta-item">
        <icon class="meta-icon" type="info" size="12" />
        <text>å‘å¸ƒæ—¶é—´ï¼š{{item.publishTime}}</text>
      </view>
      <view class="meta-item">
        <icon class="meta-icon" type="info" size="12" />
        <text>æµè§ˆæ¬¡æ•°ï¼š{{item.viewCount}}</text>
      </view>
    </view>
  </view>

  <!-- å•†å“æè¿° -->
  <view class="description-section">
    <view class="section-title">å•†å“æè¿°</view>
    <view class="description-content">{{item.description || 'æš‚æ— æè¿°'}}</view>
  </view>

  <!-- å–å®¶ä¿¡æ¯ -->
  <view class="seller-section">
    <view class="section-title">å–å®¶ä¿¡æ¯</view>
    <view class="seller-info">
      <image class="seller-avatar" src="{{seller.avatar || '/images/default-avatar.png'}}" />
      <view class="seller-details">
        <view class="seller-name">{{seller.name}}</view>
        <view class="seller-meta">å­¦å·ï¼š{{seller.studentId}}</view>
        <view class="seller-meta">ä¿¡ç”¨è¯„çº§ï¼š{{seller.rating || 'æš‚æ— è¯„çº§'}}</view>
      </view>
      <button class="contact-btn" bindtap="contactSeller" size="mini">è”ç³»å–å®¶</button>
    </view>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view class="related-section" wx:if="{{relatedItems.length > 0}}">
    <view class="section-title">ç›¸å…³æ¨è</view>
    <scroll-view class="related-scroll" scroll-x>
      <view class="related-item" wx:for="{{relatedItems}}" wx:key="id" bindtap="goToItem" data-id="{{item.id}}">
        <image class="related-image" src="{{item.images[0] || '/images/placeholder.png'}}" mode="aspectFill" />
        <view class="related-title">{{item.title}}</view>
        <view class="related-price">Â¥{{item.price}}</view>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="action-left">
      <button class="action-btn like-btn" bindtap="toggleLike" data-liked="{{isLiked}}">
        <icon type="{{isLiked ? 'success' : 'success_no_circle'}}" size="20" />
        <text>{{isLiked ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </button>
      <button class="action-btn share-btn" open-type="share">
        <icon type="success_circle" size="20" />
        <text>åˆ†äº«</text>
      </button>
    </view>
    <view class="action-right">
      <button class="contact-seller-btn" bindtap="contactSeller">
        è”ç³»å–å®¶
      </button>
      <button class="buy-btn" bindtap="showBuyModal" wx:if="{{!isSeller}}">
        ç«‹å³è´­ä¹°
      </button>
      <button class="edit-btn" bindtap="editItem" wx:if="{{isSeller}}">
        ç¼–è¾‘å•†å“
      </button>
    </view>
  </view>
</view>

<!-- è´­ä¹°ç¡®è®¤å¼¹çª— -->
<view class="modal-mask" wx:if="{{showBuyModal}}" bindtap="hideBuyModal">
  <view class="modal-content" catchtap="">
    <view class="modal-title">ç¡®è®¤è´­ä¹°</view>
    <view class="modal-body">
      <view class="buy-item-info">
        <image class="buy-image" src="{{item.images[0]}}" mode="aspectFill" />
        <view class="buy-details">
          <view class="buy-title">{{item.title}}</view>
          <view class="buy-price">Â¥{{item.price}}</view>
        </view>
      </view>
      <view class="contact-info">
        <view class="info-item">
          <text class="info-label">è”ç³»æ–¹å¼ï¼š</text>
          <input class="info-input" placeholder="è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼" bindinput="onContactInput" value="{{contactInfo}}" />
        </view>
        <view class="info-item">
          <text class="info-label">ç•™è¨€ï¼š</text>
          <textarea class="message-input" placeholder="å‘å–å®¶è¯´ç‚¹ä»€ä¹ˆ..." bindinput="onMessageInput" value="{{buyMessage}}" maxlength="200"></textarea>
        </view>
      </view>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="hideBuyModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm-btn" bindtap="confirmBuy">ç¡®è®¤è´­ä¹°</button>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading" wx:if="{{loading}}">
  <view class="loading-text">åŠ è½½ä¸­...</view>
</view>

<!-- é”™è¯¯çŠ¶æ€ -->
<view class="error-state" wx:if="{{error}}">
  <view class="error-icon">ğŸ˜</view>
  <view class="error-text">{{error}}</view>
  <button class="retry-btn" bindtap="loadItemDetail">é‡è¯•</button>
</view>